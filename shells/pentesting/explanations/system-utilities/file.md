# File Command - File Type Determination

## Overview
The `file` command is a utility for determining file types by:
- Analyzing file content and structure
- Identifying file formats and encodings
- Detecting executable types
- Recognizing compressed files
- Determining file characteristics

## Basic Usage

### Simple File Analysis
```bash
# Determine file type
file filename.txt

# Analyze multiple files
file file1.txt file2.txt file3.txt

# Analyze all files in directory
file *

# Recursive analysis
file -r directory/
```

### Output Formats
```bash
# Brief output (default)
file filename.txt

# Verbose output
file -v filename.txt

# MIME type output
file -i filename.txt

# Human-readable output
file --mime-type filename.txt
```

## File Type Detection

### Text Files
```bash
# Plain text files
file document.txt
# Output: document.txt: ASCII text

# UTF-8 text
file unicode.txt
# Output: unicode.txt: UTF-8 Unicode text

# Script files
file script.sh
# Output: script.sh: Bourne-Again shell script, ASCII text executable
```

### Executable Files
```bash
# ELF binaries (Linux)
file /bin/ls
# Output: /bin/ls: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked...

# Windows executables
file program.exe
# Output: program.exe: PE32 executable (GUI) Intel 80386, for MS Windows

# Mach-O binaries (macOS)
file /bin/ls
# Output: /bin/ls: Mach-O 64-bit executable x86_64
```

### Archive and Compressed Files
```bash
# ZIP archives
file archive.zip
# Output: archive.zip: Zip archive data, at least v2.0 to extract

# gzip compressed files
file file.gz
# Output: file.gz: gzip compressed data, from Unix, original size modulo 2^32

# tar archives
file archive.tar
# Output: archive.tar: tar archive
```

### Image and Media Files
```bash
# JPEG images
file photo.jpg
# Output: photo.jpg: JPEG image data, JFIF standard 1.01, resolution (DPI), density 72x72

# PNG images
file image.png
# Output: image.png: PNG image data, 1920 x 1080, 8-bit/color RGB, non-interlaced

# PDF files
file document.pdf
# Output: document.pdf: PDF document, version 1.4
```

## Advanced Options

### Detailed Analysis
```bash
# Show magic file information
file -m filename.txt

# Use custom magic file
file -m custom.magic file.bin

# Keep going after first match
file -k file.bin

# Suppress error messages
file -s file.txt
```

### Special Files
```bash
# Block devices
file /dev/sda1
# Output: /dev/sda1: block special

# Character devices
file /dev/null
# Output: /dev/null: character special

# Symbolic links
file -L symbolic_link
# Output: symbolic_link: symbolic link to target_file
```

### Compression Detection
```bash
# Detect compressed files
file -z compressed_file.gz

# Decompress and analyze
file -z archive.tar.gz

# Check file inside archive
file -z -C /path/to/archive.tar.gz inner_file.txt
```

## MIME Type Detection

### MIME Types
```bash
# Show MIME type
file -i document.txt
# Output: document.txt: text/plain; charset=us-ascii

# Show only MIME type
file --mime-type document.txt
# Output: document.txt: text/plain

# Show MIME encoding
file --mime-encoding document.txt
# Output: document.txt: us-ascii
```

### Common MIME Types
```bash
# Text files
file -i *.txt
# Output: file.txt: text/plain; charset=utf-8

# JSON files
file -i data.json
# Output: data.json: application/json

# XML files
file -i config.xml
# Output: config.xml: application/xml
```

## File Size and Limits

### Large Files
```bash
# Analyze first bytes of large files
file -s large_file.bin

# Limit read size
file -b file.txt

# Read specific number of bytes
head -c 100 file.txt | file -
```

### Special Files
```bash
# FIFO pipes
file named_pipe
# Output: named_pipe: fifo (named pipe)

# Sockets
file socket_file
# Output: socket_file: socket

# Empty files
file empty.txt
# Output: empty.txt: empty
```

## Practical Examples

### Security Analysis
```bash
# Check suspicious files
file suspicious_file.exe
file malware_sample.bin

# Identify packed executables
file packed_program.exe

# Detect encrypted files
file encrypted_data.bin
```

### Forensics
```bash
# Analyze disk images
file disk_image.dd

# Check file signatures
file unknown_file.bin

# Identify file system types
file /dev/sda1
```

### System Administration
```bash
# Check configuration files
file /etc/passwd
file /etc/shadow

# Verify system binaries
file /bin/ls
file /usr/bin/python3

# Check log files
file /var/log/syslog
```

### Development
```bash
# Check compiled objects
file object_file.o

# Verify shared libraries
file library.so

# Check core dumps
file core.1234
```

## Scripting and Automation

### Batch Processing
```bash
#!/bin/bash
# Analyze all files in directory

for file in *; do
    echo "=== $file ==="
    file "$file"
    echo ""
done
```

### File Classification
```bash
#!/bin/bash
# Classify files by type

text_files=()
exec_files=()
image_files=()

for file in *; do
    file_type=$(file -b --mime-type "$file")

    case "$file_type" in
        text/*)
            text_files+=("$file")
            ;;
        application/x-executable*|application/x-sharedlib*)
            exec_files+=("$file")
            ;;
        image/*)
            image_files+=("$file")
            ;;
    esac
done

echo "Text files: ${text_files[*]}"
echo "Executable files: ${exec_files[*]}"
echo "Image files: ${image_files[*]}"
```

### Security Scanning
```bash
#!/bin/bash
# Scan for suspicious files

suspicious_patterns=("executable" "MS-DOS executable" "PE32 executable")

for file in *; do
    file_info=$(file "$file")

    for pattern in "${suspicious_patterns[@]}"; do
        if echo "$file_info" | grep -q "$pattern"; then
            echo "Suspicious file detected: $file"
            echo "Info: $file_info"
        fi
    done
done
```

## Integration with Other Tools

### Combine with Find
```bash
# Find all executable files
find . -type f -exec file {} \; | grep "executable"

# Find all text files
find . -type f -exec file --mime-type {} \; | grep "text/"

# Find compressed files
find . -type f -exec file {} \; | grep "compressed"
```

### Pipe Usage
```bash
# Analyze output from other commands
ls -la | file -

# Check file type from hexdump
hexdump -C file.bin | head -10 | file -

# Analyze downloaded content
curl -s http://example.com/file | file -
```

## Magic Files

### Custom Magic Files
```bash
# Create custom magic file
echo "0 string MAGIC_FILE Custom Magic File Format" > custom.magic

# Use custom magic file
file -m custom.magic unknown_file

# System magic files
# /usr/share/misc/magic.mgc
# /etc/magic
```

### Magic File Format
```bash
# Offset Type Test Message
0 string MZ      MS-DOS executable
0 string \x7fELF  ELF executable
0 string PK      ZIP archive data
```

## Troubleshooting

### Common Issues
```bash
# File not found
file nonexistent.txt
# Output: nonexistent.txt: cannot open `nonexistent.txt' (No such file or directory)

# Permission denied
file /root/.ssh/id_rsa
# Output: /root/.ssh/id_rsa: ERROR: cannot open `/root/.ssh/id_rsa' (Permission denied)

# Unrecognized file
file unknown.bin
# Output: unknown.bin: data
```

### Debug Mode
```bash
# Show magic file matches
file -d -m /usr/share/misc/magic.mgc file.txt

# Show processing details
file -d file.txt
```

## Tips
- Use `-i` for MIME type information
- Use `-L` to follow symbolic links
- Use `-s` to suppress error messages
- Use `-k` to continue after first match
- Combine with `find` for batch processing
- Use custom magic files for proprietary formats
- Consider file size when analyzing large files
- Use `-b` for brief output in scripts
- Check file permissions when analyzing system files
- Use magic file information for understanding file formats