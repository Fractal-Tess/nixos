# TCPDump - Network Packet Analyzer

## Overview
TCPDump is a command-line packet analyzer for:
- Capturing network traffic
- Real-time network monitoring
- Protocol analysis
- Network troubleshooting

## Basic Usage

### Interface Selection
```bash
# Capture on default interface
tcpdump

# List available interfaces
tcpdump -D

# Capture on specific interface
tcpdump -i eth0

# Capture on all interfaces
tcpdump -i any
```

### Basic Capture
```bash
# Capture 100 packets
tcpdump -c 100

# Capture without name resolution
tcpdump -n

# Verbose output
tcpdump -v

# Very verbose output
tcpdump -vv
```

## Capture Filters

### Protocol Filtering
```bash
# TCP traffic only
tcpdump tcp

# UDP traffic only
tcpdump udp

# ICMP traffic
tcpdump icmp

# ARP traffic
tcpdump arp
```

### Host Filtering
```bash
# Traffic from specific host
tcpdump host 192.168.1.1

# Traffic to specific host
tcpdump dst host 192.168.1.1

# Traffic from specific host
tcpdump src host 192.168.1.1

# Traffic between two hosts
tcpdump host 192.168.1.1 and host 192.168.1.2
```

### Port Filtering
```bash
# Traffic on specific port
tcpdump port 80

# Traffic on source port
tcpdump src port 80

# Traffic on destination port
tcpdump dst port 80

# Traffic on multiple ports
tcpdump port 80 or port 443
```

### Network Filtering
```bash
# Traffic from network
tcpdump src net 192.168.1.0/24

# Traffic to network
tcpdump dst net 192.168.1.0/24

# Traffic from or to network
tcpdump net 192.168.1.0/24
```

## Advanced Filtering

### Complex Expressions
```bash
# HTTP traffic to specific host
tcpdump 'tcp port 80 and host example.com'

# SSH traffic from network
tcpdump 'tcp port 22 and src net 192.168.1.0/24'

# DNS traffic
tcpdump 'udp port 53'

# Exclude specific traffic
tcpdump 'not port 22'

# TCP SYN packets (connection attempts)
tcpdump 'tcp[tcpflags] & tcp-syn != 0'

# TCP ACK packets
tcpdump 'tcp[tcpflags] & tcp-ack != 0'
```

### Packet Content Filtering
```bash
# Packets containing specific string
tcpdump 'host 192.168.1.1 and greater 20 and ip[20:2] = 0x4745'

# HTTP GET requests
tcpdump 'tcp[((tcp[12:1] & 0xf0) >> 2):4] = 0x47455420'

# ICMP echo requests
tcpdump 'icmp[icmptype] = icmp-echo'
```

## Output Options

### Display Options
```bash
# Show packet headers
tcpdump -e

# Show data in ASCII
tcpdump -A

# Show data in hex
tcpdump -x

# Show data in hex and ASCII
tcpdump -X

# Don't truncate output
tcpdump -s 0

# Set snap length
tcpdump -s 1500
```

### Timestamp Options
```bash
# High resolution timestamps
tcpdump -t

# Don't print timestamps
tcpdump -tttt

# Absolute timestamps
tcpdump -tt
```

## File Operations

### Save Captures
```bash
# Save to file
tcpdump -w capture.pcap

# Save specific number of packets
tcpdump -c 1000 -w capture.pcap

# Rotate files (10MB each)
tcpdump -w capture_%Y%m%d_%H%M%S.pcap -C 10

# Limit total capture size
tcpdump -w capture.pcap -W 10 -C 10
```

### Read Files
```bash
# Read capture file
tcpdump -r capture.pcap

# Read file with filter
tcpdump -r capture.pcap 'port 80'

# Read multiple files
tcpdump -r capture1.pcap -r capture2.pcap
```

## Practical Examples

### Web Traffic Analysis
```bash
# Capture HTTP traffic
tcpdump -A -s 0 'tcp port 80'

# Capture HTTPS traffic (encrypted)
tcpdump -i eth0 'tcp port 443'

# Capture web traffic to specific site
tcpdump -A -s 0 'host example.com and (port 80 or port 443)'
```

### Network Troubleshooting
```bash
# Monitor connection attempts
tcpdump -i eth0 'tcp[tcpflags] & (tcp-syn|tcp-fin) != 0 and not src and dst net 127.0.0.0/8'

# Check DNS queries
tcpdump -i eth0 'udp port 53'

# Monitor ping responses
tcpdump -i eth0 'icmp[icmptype] = icmp-echoreply'
```

### Security Monitoring
```bash
# Detect port scans
tcpdump -i eth0 'tcp[tcpflags] & (tcp-syn) != 0 and tcp[tcpflags] & (tcp-ack) = 0'

# Monitor SSH connections
tcpdump -i eth0 'tcp port 22'

# Track suspicious activity
tcpdump -i eth0 'not port 22 and not port 80 and not port 443'
```

### Performance Analysis
```bash
# Monitor packet loss
tcpdump -i eth0 -e 'not arp'

# Track network bandwidth
tcpdump -i eth0 -w - | tcpdump -r - -tttt | wc -l

# Monitor specific application
tcpdump -i eth0 -A 'src host app-server and port 8080'
```

## Protocol-Specific Examples

### TCP Analysis
```bash
# TCP connection establishment
tcpdump 'tcp[tcpflags] & (tcp-syn|tcp-ack) != 0'

# TCP connection termination
tcpdump 'tcp[tcpflags] & (tcp-fin|tcp-rst) != 0'

# TCP retransmissions
tcpdump 'tcp[tcpflags] & (tcp-rst) != 0'
```

### UDP Analysis
```bash
# UDP traffic monitoring
tcpdump -i eth0 'udp'

# DHCP traffic
tcpdump -i eth0 'udp port 67 or udp port 68'

# SNMP traffic
tcpdump -i eth0 'udp port 161'
```

### ARP Analysis
```bash
# ARP requests and replies
tcpdump -i eth0 'arp'

# ARP monitoring
tcpdump -i eth0 -e 'arp'
```

## Real-Time Monitoring

### Continuous Monitoring
```bash
# Monitor and log to file
tcpdump -i eth0 -w capture.pcap -C 100 -W 10

# Monitor with real-time analysis
tcpdump -i eth0 -l | grep 'GET'

# Monitor specific pattern
tcpdump -i eth0 -A 'port 80' | grep 'User-Agent'
```

## Tips
- Use `-n` to avoid DNS delays during capture
- Use appropriate snap length (-s) for performance
- Combine with other tools for comprehensive analysis
- Be aware of disk space when saving captures
- Use filters to reduce capture file size
- Consider legal and privacy implications
- Use high-performance systems for high-traffic networks