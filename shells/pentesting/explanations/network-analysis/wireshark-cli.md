# Wireshark CLI - Network Protocol Analyzer

## Overview
Wireshark CLI (tshark) is a command-line network protocol analyzer for:
- Capturing and analyzing network traffic
- Protocol decoding and analysis
- Network troubleshooting
- Security monitoring

## Basic Usage

### Live Capture
```bash
# Capture on default interface
tshark

# Capture on specific interface
tshark -i eth0

# Capture with interface list
tshark -D

# Capture for specific duration
tshark -i eth0 -a duration:60
```

### File Analysis
```bash
# Analyze capture file
tshark -r capture.pcap

# Read multiple files
tshark -r capture1.pcap -r capture2.pcap

# Read from stdin
tcpdump -w - | tshark -r -
```

## Display Filters

### Basic Filtering
```bash
# Filter by protocol
tshark -r capture.pcap -Y "http"

# Filter by IP address
tshark -r capture.pcap -Y "ip.addr == 192.168.1.1"

# Filter by port
tshark -r capture.pcap -Y "tcp.port == 80"

# Filter by MAC address
tshark -r capture.pcap -Y "eth.addr == 00:11:22:33:44:55"
```

### Complex Filters
```bash
# HTTP traffic to specific host
tshark -r capture.pcap -Y "http.host == \"example.com\""

# DNS queries
tshark -r capture.pcap -Y "dns.flags.response == 0"

# TCP SYN packets
tshark -r capture.pcap -Y "tcp.flags.syn == 1 and tcp.flags.ack == 0"

# Failed SSH connections
tshark -r capture.pcap -Y "ssh and tcp.analysis.retransmission"
```

## Capture Options

### Capture Filters
```bash
# Capture only HTTP traffic
tshark -i eth0 -f "tcp port 80"

# Capture specific host
tshark -i eth0 -f "host 192.168.1.1"

# Capture network range
tshark -i eth0 -f "net 192.168.1.0/24"

# Capture multiple ports
tshark -i eth0 -f "tcp port 22 or tcp port 443"
```

### Capture Settings
```bash
# Limit packet count
tshark -i eth0 -c 1000

# Set snaplength
tshark -i eth0 -s 1500

# Promiscuous mode
tshark -i eth0 -p

# Disable name resolution
tshark -i eth0 -n
```

## Output Options

### Display Formats
```bash
# Brief output (default)
tshark -r capture.pcap

# Detailed protocol information
tshark -r capture.pcap -V

# Hex dump
tshark -r capture.pcap -x

# Packet summary
tshark -r capture.pcap -z

# JSON output
tshark -r capture.pcap -T json

# Fields output
tshark -r capture.pcap -T fields
```

### Field Extraction
```bash
# Extract specific fields
tshark -r capture.pcap -T fields -e ip.src -e ip.dst -e tcp.port

# Extract HTTP headers
tshark -r capture.pcap -Y "http" -T fields -e http.host -e http.user_agent

# Extract DNS queries
tshark -r capture.pcap -Y "dns" -T fields -e dns.qry.name -e dns.flags.response

# Custom separator
tshark -r capture.pcap -T fields -e ip.src -e ip.dst -E separator=","
```

## Protocol Analysis

### HTTP Analysis
```bash
# HTTP requests and responses
tshark -r capture.pcap -Y "http" -T fields -e http.request.method -e http.host -e http.request.uri

# Extract HTTP objects
tshark -r capture.pcap -Y "http.file_data" -T fields -e http.file_data

# HTTP status codes
tshark -r capture.pcap -Y "http.response.code" -T fields -e http.response.code
```

### TLS/SSL Analysis
```bash
# TLS handshakes
tshark -r capture.pcap -Y "tls.handshake.type == 1"

# Certificate information
tshark -r capture.pcap -Y "tls.handshake.certificate" -V

# Extract certificate details
tshark -r capture.pcap -Y "x509sat" -T fields -e x509sat.uAstr
```

### DNS Analysis
```bash
# DNS queries and responses
tshark -r capture.pcap -Y "dns" -T fields -e dns.qry.name -e dns.flags.response -e dns.a

# DNS over HTTPS
tshark -r capture.pcap -Y "http.request.method == \"GET\" and http.request.uri contains \"dns-query\""
```

## Statistics and Analysis

### Protocol Hierarchy
```bash
# Protocol hierarchy statistics
tshark -r capture.pcap -q -z io,phs

# Endpoint statistics
tshark -r capture.pcap -q -z io,stat,0,"COUNT(http.request.method)http.request.method"

# Conversation statistics
tshark -r capture.pcap -q -z conv,tcp

# HTTP requests
tshark -r capture.pcap -q -z http_req,tree
```

### Flow Analysis
```bash
# TCP streams
tshark -r capture.pcap -q -z conv,tcp

# UDP streams
tshark -r capture.pcap -q -z conv,udp

# Follow TCP stream
tshark -r capture.pcap -Y "tcp.stream == 0"
```

## Practical Examples

### Security Monitoring
```bash
# Detect potential attacks
tshark -i eth0 -Y "tcp.flags.syn == 1 and tcp.flags.ack == 0" -c 100

# Monitor suspicious traffic
tshark -i eth0 -Y "http.user_agent contains \"scanner\""

# Track data exfiltration
tshark -i eth0 -Y "ip.src == internal_net and ip.dst == external_net and tcp.port == 443"
```

### Network Troubleshooting
```bash
# Monitor connection attempts
tshark -i eth0 -Y "tcp.flags.syn == 1"

# Check DNS resolution
tshark -i eth0 -Y "dns" -T fields -e dns.qry.name -e dns.a

# Monitor bandwidth usage
tshark -i eth0 -q -z io,stat,1,"COUNT(frame)frame" "SUM(frame.len)frame.len"
```

### Forensics Analysis
```bash
# Extract all URLs from capture
tshark -r capture.pcap -Y "http.request.uri" -T fields -e http.request.uri

# Find file downloads
tshark -r capture.pcap -Y "http.file_data" -T fields -e http.host -e http.request.uri

# Track user activity
tshark -r capture.pcap -Y "http" -T fields -e ip.src -e http.host -e http.request.uri
```

## Advanced Features

### Two-Pass Analysis
```bash
# Two-pass analysis for better filtering
tshark -r capture.pcap -2 -Y "http"
```

### Decryption
```bash
# Decrypt TLS with key file
tshark -r capture.pcap -o tls.keylog_file:/path/to/keylog.txt -Y "tls"
```

### Custom Configuration
```bash
# Use custom configuration
tshark -C /path/to/config -r capture.pcap
```

## Tips
- Use display filters for efficient analysis
- Capture specific traffic to reduce file size
- Use field extraction for automated processing
- Combine with other tools for comprehensive analysis
- Consider privacy and legal implications when capturing traffic
- Use appropriate buffer sizes for high-speed networks