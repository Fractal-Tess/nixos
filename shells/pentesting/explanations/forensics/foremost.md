# Foremost - File Carving Tool

## Overview
Foremost is a console program for recovering files based on their headers, footers, and data structures:
- File carving and recovery
- Data recovery from disk images
- Digital forensics
- File signature analysis
- Extracting embedded files

## Basic Usage

### File Recovery
```bash
# Recover files from image file
foremost image.dd

# Recover files to specific directory
foremost -o /path/to/output image.dd

# Recover specific file types
foremost -t pdf,jpg,gif image.dd

# Verbose output
foremost -v image.dd
```

### Basic Options
```bash
# Specify output directory
foremost -o recovered_files image.dd

# Quiet mode
foremost -q image.dd

# Write audit file
foremost -a image.dd

# Use configuration file
foremost -c config.conf image.dd
```

## File Type Specification

### Default File Types
```bash
# List supported file types
foremost -t all

# Common file types
foremost -t jpg,gif,png,pdf,doc,zip

# Audio/Video files
foremost -t mp3,wav,avi,mov

# Executable files
foremost -t exe,dll,elf
```

### Custom File Types
```bash
# Create custom configuration
cat > foremost.conf << EOF
# Custom file types
jpg y 2000000 ff d8 ff e0 ff e1 ff e2
png y 2000000 89 50 4e 47 0d 0a 1a 0a
EOF

# Use custom configuration
foremost -c foremost.conf image.dd
```

## Advanced Options

### Configuration File
```bash
# Default configuration location
/etc/foremost.conf

# Custom configuration file
foremost -c /path/to/custom.conf image.dd

# Configuration format:
# extension y/n size header footer
# y = carve, n = ignore
# size = maximum file size
# header = file signature
# footer = end signature
```

### File Signatures
```bash
# JPEG files
jpg y 2000000 ff d8 ff e0 ff e1 ff e2

# PNG files
png y 2000000 89 50 4e 47 0d 0a 1a 0a

# PDF files
pdf y 10000000 25 50 44 46

# ZIP files
zip y 10000000 50 4b 03 04
```

### Size and Performance
```bash
# Set maximum file size
foremost -s 1000000 image.dd

# Set buffer size
foremost -b 4096 image.dd

# Skip disk image header
foremost -k 512 image.dd

# Process specific offset
foremost -o 1024 image.dd
```

## Practical Examples

### Basic File Recovery
```bash
# Recover all file types
foremost -o /tmp/recovery disk_image.dd

# Recover only images
foremost -t jpg,gif,png,bmp -o recovered_images disk_image.dd

# Recover documents
foremost -t doc,pdf,txt -o recovered_docs disk_image.dd
```

### Forensic Analysis
```bash
# Create audit file
foremost -a -o forensic_output evidence.dd

# Verbose output for analysis
foremost -v -o analysis_output suspect.dd

# Process only specific sectors
foremost -s 1048576 -o partial_output evidence.dd
```

### Custom Recovery
```bash
# Use custom signatures
cat > custom.conf << EOF
# Custom file types
log y 1000000 54 68 69 73 20 69 73 20 61 20 6c 6f 67
dat y 5000000 44 41 54 41
EOF

foremost -c custom.conf -o custom_recovery image.dd
```

## Automation Scripts

### Batch Processing
```bash
#!/bin/bash
# Batch file recovery

input_dir="/path/to/disk_images"
output_dir="/path/to/recovered"

mkdir -p "$output_dir"

for image in "$input_dir"/*.dd; do
    if [ -f "$image" ]; then
        basename=$(basename "$image" .dd)
        echo "Processing $image..."
        mkdir -p "$output_dir/$basename"
        foremost -o "$output_dir/$basename" "$image"
    fi
done

echo "Recovery complete. Results in $output_dir/"
```

### File Type Classification
```bash
#!/bin/bash
# Classify recovered files by type

recovery_dir="$1"

if [ -z "$recovery_dir" ]; then
    echo "Usage: $0 <recovery_directory>"
    exit 1
fi

cd "$recovery_dir"

# Create organized output
mkdir -p classified/{images,documents,archives,others}

# Move files to appropriate directories
mv *.jpg *.jpeg *.gif *.png *.bmp classified/images/ 2>/dev/null
mv *.pdf *.doc *.docx *.txt classified/documents/ 2>/dev/null
mv *.zip *.rar *.7z *.tar classified/archives/ 2>/dev/null
mv * classified/others/ 2>/dev/null

echo "Files classified in classified/"
```

### Recovery Report Generator
```bash
#!/bin/bash
# Generate recovery report

recovery_dir="$1"
report="recovery_report.txt"

if [ -z "$recovery_dir" ]; then
    echo "Usage: $0 <recovery_directory>"
    exit 1
fi

cat > "$report" << EOF
File Recovery Report
===================
Date: $(date)
Source Directory: $recovery_dir

File Types Found:
EOF

# Count file types
find "$recovery_dir" -type f -name "*.jpg" -o -name "*.jpeg" | wc -l | awk '{print "JPEG Images: " $1}' >> "$report"
find "$recovery_dir" -type f -name "*.png" -o -name "*.gif" -o -name "*.bmp" | wc -l | awk '{print "Other Images: " $1}' >> "$report"
find "$recovery_dir" -type f -name "*.pdf" | wc -l | awk '{print "PDF Documents: " $1}' >> "$report"
find "$recovery_dir" -type f -name "*.doc" -o -name "*.docx" | wc -l | awk '{print "Word Documents: " $1}' >> "$report"
find "$recovery_dir" -type f -name "*.zip" -o -name "*.rar" -o -name "*.7z" | wc -l | awk '{print "Archives: " $1}' >> "$report"

echo "" >> "$report"
echo "Total Files Recovered: $(find "$recovery_dir" -type f | wc -l)" >> "$report"
echo "Total Size: $(du -sh "$recovery_dir" | cut -f1)" >> "$report"

echo "Report saved to $report"
```

## Integration with Other Tools

### Combine with dd
```bash
# Create disk image first
dd if=/dev/sdb of=disk_image.dd bs=512 conv=noerror,sync

# Then recover files
foremost -o recovered_files disk_image.dd

# Process specific partition
dd if=/dev/sdb1 of=partition_image.dd bs=512 skip=2048
foremost -o partition_recovered partition_image.dd
```

### Combine with strings
```bash
# Extract strings before recovery
strings disk_image.dd > image_strings.txt

# Look for interesting strings
grep -i "password\|secret\|admin" image_strings.txt

# Then recover files
foremost -o recovered_files disk_image.dd
```

### Combine with hexdump
```bash
# Examine file headers
hexdump -C disk_image.dd | head -20

# Look for file signatures
hexdump -C disk_image.dd | grep "ff d8 ff"

# Then recover with foremost
foremost -o recovered_files disk_image.dd
```

## Advanced Techniques

### Custom File Signatures
```bash
# Create signature for custom file type
cat >> custom.conf << EOF

custom y 1000000 43 55 53 54 4f 4d 0a 46 49 4c 45 20 46 4f 52 4d 41 54
EOF

# Test custom signature
foremost -c custom.conf -o custom_recovery disk_image.dd
```

### Multi-Pass Recovery
```bash
# First pass: common files
foremost -t jpg,gif,png,pdf -o pass1 disk_image.dd

# Second pass: all files
foremost -a -o pass2 disk_image.dd

# Third pass: custom signatures
foremost -c custom.conf -o pass3 disk_image.dd
```

### Selective Recovery
```bash
# Recover only large files
foremost -s 10000000 -o large_files disk_image.dd

# Recover from specific offset
foremost -o 1048576 -o offset_recovery disk_image.dd

# Skip first MB
foremost -k 1048576 -o skip_recovery disk_image.dd
```

## Troubleshooting

### Common Issues
```bash
# Permission denied
sudo foremost -o recovered_files disk_image.dd

# Disk image not found
ls -la disk_image.dd
file disk_image.dd

# No files recovered
foremost -v disk_image.dd
hexdump -C disk_image.dd | head -10
```

### Performance Issues
```bash
# Slow processing
# Use specific file types
foremost -t jpg,pdf disk_image.dd

# Memory issues
# Process in smaller chunks
foremost -s 1000000 disk_image.dd
```

## Tips
- Always work on copies of original evidence
- Use appropriate file size limits
- Create audit files for documentation
- Consider using multiple passes for thorough recovery
- Verify recovered files are not corrupted
- Store recovered files securely
- Document the recovery process
- Use custom signatures for proprietary file types
- Combine with other forensic tools for comprehensive analysis
- Consider the legal implications of file recovery
- Test recovery on known data before processing evidence