# BIND DNS Utilities - DNS Query Tools

## Overview
BIND DNS utilities provide tools for DNS queries and troubleshooting:
- dig - Domain Information Groper
- host - DNS lookup utility
- nslookup - DNS query tool
- DNS debugging and analysis

## DIG (Domain Information Groper)

### Basic DNS Queries
```bash
# Basic A record query
dig example.com

# Query specific record type
dig example.com A
dig example.com AAAA
dig example.com MX
dig example.com TXT

# Query from specific DNS server
dig @8.8.8.8 example.com
dig @1.1.1.1 example.com
```

### Advanced DIG Options
```bash
# Short output
dig +short example.com

# Detailed output
dig +noall +answer example.com

# Trace DNS path
dig +trace example.com

# Query DNSSEC
dig +dnssec example.com

# Reverse lookup
dig -x 8.8.8.8
```

### Zone Transfers
```bash
# Attempt zone transfer
dig @ns1.example.com example.com AXFR

# With specific port
dig @ns1.example.com -p 5353 example.com AXFR

# TSIG authenticated transfer
dig @ns1.example.com example.com AXFR +y keyname:secret
```

### DNSSEC Queries
```bash
# Query DNSSEC records
dig +dnssec example.com

# Get DNSKEY
dig example.com DNSKEY

# Get DS records
dig example.com DS

# Validate DNSSEC
dig +dnssec +multiline example.com
```

## HOST Command

### Basic Host Queries
```bash
# Basic lookup
host example.com

# Specific record type
host -t MX example.com
host -t TXT example.com
host -t AAAA example.com

# Using specific DNS server
host example.com 8.8.8.8
```

### Host Options
```bash
# Verbose output
host -v example.com

# Debug output
host -d example.com

# Any record type
host -t ANY example.com

# Reverse lookup
host 8.8.8.8
```

## NSLOOKUP

### Interactive Mode
```bash
# Start interactive mode
nslookup

# In interactive mode:
> server 8.8.8.8
> example.com
> set type=MX
> example.com
> exit
```

### Non-interactive Mode
```bash
# Basic lookup
nslookup example.com

# Specific server
nslookup example.com 8.8.8.8

# Specific record type
nslookup -type=MX example.com
```

## Record Type Queries

### Common Record Types
```bash
# A records (IPv4)
dig example.com A
host -t A example.com

# AAAA records (IPv6)
dig example.com AAAA
host -t AAAA example.com

# MX records (Mail exchange)
dig example.com MX
host -t MX example.com

# NS records (Name servers)
dig example.com NS
host -t NS example.com

# CNAME records (Canonical name)
dig www.example.com CNAME
host -t CNAME www.example.com
```

### Special Record Types
```bash
# TXT records
dig example.com TXT
host -t TXT example.com

# SOA records (Start of Authority)
dig example.com SOA
host -t SOA example.com

# PTR records (Reverse lookup)
dig -x 8.8.8.8
host 8.8.8.8

# SRV records (Service location)
dig _http._tcp.example.com SRV
```

## DNSSEC Operations

### DNSSEC Validation
```bash
# Query with DNSSEC
dig +dnssec example.com

# Get DNSKEY records
dig example.com DNSKEY +multi

# Get DS records
dig example.com DS

# Check RRSIG
dig example.com DNSKEY +dnssec
```

### Trust Chain
```bash
# Trace DNSSEC chain
dig +dnssec +trace example.com

# Validate trust chain
dig +dnssec +noadditional example.com
```

## DNS Enumeration

### Zone Enumeration
```bash
# Attempt zone transfer
dig @ns1.example.com example.com AXFR

# Enumerate subdomains
dig @ns1.example.com www.example.com
dig @ns1.example.com mail.example.com
dig @ns1.example.com ftp.example.com

# Common subdomain enumeration
for sub in www mail ftp admin test dev; do
    dig $sub.example.com A
done
```

### DNS Cache Snooping
```bash
# Check if domain is in cache
dig @dns.server.com www.example.com

# Check for cached NXDOMAIN
dig @dns.server.com nonexistent.example.com
```

## DNS Performance Testing

### Response Time Testing
```bash
# Time DNS queries
time dig example.com

# Test multiple servers
for server in 8.8.8.8 1.1.1.1 9.9.9.9; do
    echo "Testing $server:"
    time dig @$server example.com
done
```

### Bulk DNS Queries
```bash
# Query multiple domains
for domain in google.com facebook.com twitter.com; do
    dig $domain A +short
done

# Save results to file
for domain in $(cat domains.txt); do
    echo "$domain: $(dig $domain A +short)"
done > dns_results.txt
```

## DNS Troubleshooting

### Common Issues
```bash
# Check DNS resolution
dig example.com

# Check specific server
dig @8.8.8.8 example.com

# Trace DNS path
dig +trace example.com

# Check reverse DNS
dig -x 8.8.8.8
```

### Debugging Options
```bash
# Verbose output
dig +example.com +all

# Show query details
dig +trace example.com

# Check DNSSEC
dig +dnssec example.com

# Show additional records
dig +additional example.com
```

## Security Testing

### DNS Security Assessment
```bash
# Check for zone transfers
for ns in $(dig example.com NS +short); do
    echo "Testing zone transfer on $ns"
    dig @$ns example.com AXFR
done

# Check for open resolvers
echo "127.0.0.1" | while read ip; do
    dig @$ip google.com > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        echo "Open resolver found: $ip"
    fi
done

# Check DNS amplification potential
dig +recurse @dns.server.com example.com ANY
```

### DNS Cache Poisoning
```bash
# Test for cache poisoning
dig @dns.server.com -t A nonexistent.example.com
dig @dns.server.com -t A nonexistent.example.com

# Check for cache poisoning vulnerabilities
dig +dnssec +cd example.com
```

## Practical Examples

### DNS Reconnaissance Script
```bash
#!/bin/bash
# DNS reconnaissance script

target="$1"

if [ -z "$target" ]; then
    echo "Usage: $0 <domain>"
    exit 1
fi

echo "=== DNS Reconnaissance for $target ==="

# Basic information
echo "A Records:"
dig $target A +short

echo "AAAA Records:"
dig $target AAAA +short

echo "MX Records:"
dig $target MX +short

echo "NS Records:"
dig $target NS +short

echo "TXT Records:"
dig $target TXT +short

# Zone transfer attempts
echo "=== Zone Transfer Attempts ==="
for ns in $(dig $target NS +short); do
    echo "Testing zone transfer on $ns:"
    dig @$ns $target AXFR +short | head -10
done

# Common subdomain enumeration
echo "=== Common Subdomains ==="
subdomains=(www mail ftp admin api dev test blog shop)
for sub in "${subdomains[@]}"; do
    result=$(dig $sub.$target A +short)
    if [ ! -z "$result" ]; then
        echo "$sub.$target: $result"
    fi
done
```

### DNS Performance Monitor
```bash
#!/bin/bash
# DNS performance monitoring

servers=("8.8.8.8" "1.1.1.1" "9.9.9.9" "208.67.222.222")
domains=("google.com" "facebook.com" "twitter.com" "github.com")

echo "DNS Performance Test"
echo "===================="

for server in "${servers[@]}"; do
    echo "Testing DNS server: $server"
    for domain in "${domains[@]}"; do
        start_time=$(date +%s%N)
        result=$(dig @$server $domain +short)
        end_time=$(date +%s%N)
        elapsed=$((($end_time - $start_time) / 1000000))

        if [ ! -z "$result" ]; then
            echo "  $domain: ${elapsed}ms - $result"
        else
            echo "  $domain: Failed"
        fi
    done
    echo ""
done
```

### DNSSEC Validation Script
```bash
#!/bin/bash
# DNSSEC validation check

domain="$1"

if [ -z "$domain" ]; then
    echo "Usage: $0 <domain>"
    exit 1
fi

echo "=== DNSSEC Validation for $domain ==="

# Get DNSKEY
echo "Getting DNSKEY:"
dig $domain DNSKEY +dnssec

# Get DS
echo "Getting DS:"
dig $domain DS

# Validate response
echo "Validating response:"
dig +dnssec $domain

# Check chain of trust
echo "Checking chain of trust:"
dig +dnssec +trace $domain
```

## Advanced DNS Operations

### DNS over HTTPS/TLS
```bash
# DNS over HTTPS (requires specific tools)
# Using curl for DoH (if supported)
curl "https://cloudflare-dns.com/dns-query?name=example.com&type=A" \
     -H "accept: application/dns-json"

# DNS over TLS (requires specific tools)
# Using kdig (if available)
kdig @dns.google.com +tls-ca +https get example.com A
```

### EDNS0 Options
```bash
# EDNS0 client subnet
dig +subnet=192.168.1.0/24 example.com

# DNS Cookie
dig +cookie example.com

# EDNS0 buffer size
dig +edns=0 example.com
```

## Tips
- Use `dig` for detailed DNS analysis
- Use `host` for simple lookups
- Use `nslookup` for compatibility with older systems
- Always check for zone transfers on name servers
- Use DNSSEC validation for security
- Test DNS performance with multiple servers
- Be careful with DNS queries during security testing
- Document DNS configurations for reference
- Use appropriate record types for specific information
- Consider privacy implications of DNS queries